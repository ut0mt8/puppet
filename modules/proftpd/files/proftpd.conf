# ###############################################
# ####### !!! UNDER PUPPET CONTROL !!! ##########
# ###############################################


ServerName			"Plateforme corporate"
ServerType			standalone
DeferWelcome			Off
ServerIdent			On "Plateforme corporate"

MultilineRFC2228		on
DefaultServer			on
ShowSymlinks			on

# On ne fait pas d'ident lookups - cela amène un délai de 10s dans certains cas
IdentLookups			off

# Valeurs diminuées mais loin d'être scandaleuses
TimeoutNoTransfer		240
TimeoutStalled			240
TimeoutIdle			600
TimeoutLogin			120

# Debug - ne pas laisser activé, ça fait planter le serveur ?!?!!
#DebugLevel			6

DisplayLogin                    welcome.msg
DisplayFirstChdir               .message
ListOptions                	"-l"

DenyFilter			\*.*/

##################################
# Logging                        #
##################################
# Journal des transferts
# Plus 
TransferLog			/var/log/proftpd/xferlog

# Ajout de log dans wtmp - on par défaut
WtmpLog				on


##################################
# Contrôle des taux de transfert #
##################################
# Limite à 200 Ko/s pour tous les transferts sauf pour les fichiers
# de moins de 8 Ko
TransferRate	APPE,RETR,STOR,STOU	80.0:8192

# Pas besoin d'un shell valide pour se connecter
# En effet les utilisateurs n'auront pas de shell sur cette machine
RequireValidShell off


# Par défaut l'utilisateur se retrouve dans son rép sans possibilité
# d'en bouger
# A noter que cette fonction prend un argument en plus :
# On peut ajouter le nom du groupe UNIX auquel elle s'applique
# On peut donc rajouter des directives DefaultRoot pour se donner
# un accès plus large si nécessaire
DefaultRoot 			~

# Interdit de changer les règles à l'aide de .ftpaccess
AllowOverride			off
# Reprise des téléchargements autorisée
AllowRetrieveRestart		on
# Reprise des uploads autorisée
AllowStoreRestart		on
# Effacer les uploads non terminés ?
DeleteAbortedStores		off

# On ne veut pas forcément afficher l'utilisateur et le groupe propriétaire
# des fichiers, on met donc par défaut des informations bidon
# L'utilisateur et le groupe n'ont pas à exister au niveau de la machine
DirFakeUser			on	ftp
DirFakeGroup			on	ftp
#DirFakeMode			750

# GroupOwner permet de forcer le groupe propriétaire du fichier
# Un peu délicat à utiliser, me semble-t-il
#GroupOwner www-data

# Montrer les liens symboliques ?
ShowSymlinks			off

# We don't want .ftpaccess or .htaccess files to be uploaded
#PathDenyFilter "(\\.ftpaccess)|(\\.htaccess)$"

# HideFiles sert à cacher des fichiers
# HideGroup à les cacher en se baseant sur le groupe propriétaire
# HideNoAccess on/off à cacher les réps auquel l'utilisateur n'a pas accès
# IgnoreHidden à ignorer les fichiers cachés 
# Uncomment this if you are using NIS or LDAP to retrieve passwords:
#PersistentPasswd		off

# Uncomment this if you would use TLS module:
#TLSEngine 			on

# Uncomment this if you would use quota module:
#Quotas				on

# Uncomment this if you would use ratio module:
#Ratios				on

# Port 21 is the standard FTP port.
Port				21

# To prevent DoS attacks, set the maximum number of child processes
# to 30.  If you need to allow more than 30 concurrent connections
# at once, simply increase this value.  Note that this ONLY works
# in standalone mode, in inetd mode you should use an inetd server
# that allows you to limit maximum number of processes per service
# (such as xinetd)

# Utilisateurs max par hôte
#MaxClientsPerHost		2

# Utilisateurs max par client
# Vaut mieux limiter sur cette donnée
MaxClientsPerUser		4

# On remonte la valeur de 30 à 50
MaxInstances			50

# Set the user and group that the server normally runs at.
User				nobody
Group				nogroup

# Umask 022 is a good standard umask to prevent new files and dirs
# (second parm) from being group and world writable.
# Umask <fichiers> <répertoires>
Umask				007  007
# Normally, we want files to be overwriteable.
AllowOverwrite			on

# Delay engine reduces impact of the so-called Timing Attack described in
# http://security.lss.hr/index.php?page=details&ID=LSS-2004-10-02
# It is on by default. 
# Passe a "off" le 20100324 par mal
DelayEngine 			off

# A basic anonymous configuration, no upload directories.

# <Anonymous ~ftp>
#   User				ftp
#   Group				nogroup
#   # We want clients to be able to login with "anonymous" as well as "ftp"
#   UserAlias			anonymous ftp
#   # Cosmetic changes, all files belongs to ftp user
#   DirFakeUser	on ftp
#   DirFakeGroup on ftp
# 
#   RequireValidShell		off
# 
#   # Limit the maximum number of anonymous logins
#   MaxClients			10
# 
#   # We want 'welcome.msg' displayed at login, and '.message' displayed
#   # in each newly chdired directory.
#   DisplayLogin			welcome.msg
#   DisplayFirstChdir		.message
# 
#   # Limit WRITE everywhere in the anonymous chroot
#   <Directory *>
#     <Limit WRITE>
#       DenyAll
#     </Limit>
#   </Directory>
# 
#   # Uncomment this if you're brave.
#   # <Directory incoming>
#   #   # Umask 022 is a good standard umask to prevent new files and dirs
#   #   # (second parm) from being group and world writable.
#   #   Umask				022  022
#   #            <Limit READ WRITE>
#   #            DenyAll
#   #            </Limit>
#   #            <Limit STOR>
#   #            AllowAll
#   #            </Limit>
#   # </Directory>
# 
# </Anonymous>

# Root n'a pas le droit de se connecter, normal
<Global>
	RootLogin off
</Global>


# Nécessaire pour que la directive UserOwner fonctionne
<IfModule mod_cap.c>
	CapabilitiesEngine on
	CapabilitiesSet +CAP_CHOWN -CAP_DAC_OVERRIDE -CAP_DAC_READ_SEARCH
</IfModule>

# Tous les fichiers posés appartiennent à www-data
<Directory /home/www/clients>
#	UserOwner	www-data
</Directory>


# Interdire le SITE CHMOD
<Limit CHMOD SITE_CHMOD>
	AllowAll
</Limit>

